#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include "pattern.h"

unsigned char alpha_font_upper[26][8] = {

/*
	 *
	* *
   *   *
   *****
   *   *
   *   *
   *   *
*/
	{0x00, 0x20, 0x50, 0x88, 0xF8, 0x88, 0x88, 0x88},

/*
   ****
   *   *
   *   *
   ****
   *   *
   *   *
   ****
*/
	{0x00, 0xF0, 0x88, 0x88, 0xF0, 0x88, 0x88, 0xF0},

/*
	***
   *   *
   *   
   *
   *   
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x80, 0x80, 0x80, 0x88, 0x70},

/*
   ****
   *   *
   *   *
   *   *
   *   *
   *   *
   ****
*/
	{0x00, 0xF0, 0x88, 0x88, 0x88, 0x88, 0x88, 0xF0 },

/*
   *****
   *   
   *   
   ***
   *   
   *   
   *****
*/
	{0x00, 0xF8, 0x80, 0x80, 0xE0, 0x80, 0x80, 0xF8 },

/*
   *****
   *   
   *   
   ***
   *   
   *   
   *
*/
	{0x00, 0xF8, 0x80, 0x80, 0xE0, 0x80, 0x80, 0x80 },

/*
	***
   *   *
   *   
   * ***
   *   *
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x80, 0xB8, 0x88, 0x88, 0x70 },

/*
   *   *
   *   *
   *   *
   *****
   *   *
   *   *
   *   *
*/
	{0x00, 0x88, 0x88, 0x88, 0xF8, 0x88, 0x88, 0x88 },

/*
	***
	 *
	 * 
	 * 
	 * 
	 * 
	***
*/
	{0x00, 0x70, 0x20, 0x20, 0x20, 0x20, 0x20, 0x70 },

/*
	   *
	   *
	   *
	   *
	   *
   *   *
	***
*/
	{0x00, 0x08, 0x08, 0x08, 0x08, 0x08, 0x88, 0x70 },

/*
   *   *
   *   *
   *  *
   ***
   *  *
   *   *
   *   *
*/
	{0x00, 0x88, 0x88, 0x90, 0xE0, 0x90, 0x88, 0x88 },

/*
   *
   *
   *
   *
   *
   *
   *****
*/
	{0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xF8 },

/*
   *   *
   ** **
   * * *
   * * *
   *   *
   *   *
   *   *
*/
	{0x00, 0x88, 0xD8, 0xA8, 0xA8, 0x88, 0x88, 0x88 },

/*
   *   *
   *   *
   **  *
   * * *
   *  **
   *   *
   *   *
*/
	{0x00, 0x88, 0x88, 0xC8, 0xA8, 0x98, 0x88, 0x88 },

/*
	***
   *   *
   *   *
   *   *
   *   *
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70 },

/*
   ****
   *   *
   *   *
   ****
   *
   *
   *
*/
	{0x00, 0xF0, 0x88, 0x88, 0xF0, 0x80, 0x80, 0x80 },

/*
	***
   *   *
   *   *
   *   *
   * * *
   *  *
	** *
*/
	{0x00, 0x70, 0x88, 0x88, 0x88, 0xA8, 0x90, 0x68 },

/*
   ****
   *   *
   *   *
   ****
   * *
   *  *
   *   *
*/
	{0x00, 0xF0, 0x88, 0x88, 0xF0, 0xA0, 0x90, 0x88 },

/*
	***
   *   *
   *   
	***
	   *
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x80, 0x70, 0x08, 0x88, 0x70 },

/*
   *****
	 *
	 * 
	 * 
	 * 
	 * 
	 * 
*/
	{0x00, 0xF8, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20 },

/*
   *   *
   *   *
   *   *
   *   *
   *   *
   *   *
	***
*/
	{0x00, 0x88, 0x88, 0x88, 0x88, 0x88, 0x88, 0x70 },

/*
   *   *
   *   *
   *   *
   *   *
   *   *
	* *
	 *
*/
	{0x00, 0x88, 0x88, 0x88, 0x88, 0x88, 0x50, 0x20 },

/*
   *   *
   *   *
   *   *
   * * *
   * * *
   ** **
   *   *
*/
	{0x00, 0x88, 0x88, 0x88, 0xA8, 0xA8, 0xD8, 0x88 },

/*
   *   *
   *   *
	* *
	 *
	* *
   *   *
   *   *
*/
	{0x00, 0x88, 0x88, 0x50, 0x20, 0x50, 0x88, 0x88 },

/*
   *   *
   *   *
	* *
	 *
	 * 
	 * 
	 * 
*/
	{0x00, 0x88, 0x88, 0x50, 0x20, 0x20, 0x20, 0x20 },

/*
   *****
	   *
	  * 
	 * 
	* 
   * 
   *****
*/
	{0x00, 0xF8, 0x08, 0x10, 0x20, 0x40, 0x80, 0xF8 }

};

static unsigned char alpha_font_lower[26][8] = {

/*
	  
	   
	*** 
	   *
	****
   *   *
	****
*/
	{0x00, 0x00, 0x00, 0x70, 0x08, 0x78, 0x88, 0x78 },

/*
   *   
   *	
   **** 
   *   *
   *   *
   *   *
   ****
*/
	{0x00, 0x80, 0x80, 0xF0, 0x88, 0x88, 0x88, 0xF0 },

/*
		
		
	***
   *   *
   *   
   *   *
	***
*/
	{0x00, 0x00, 0x00, 0x70, 0x88, 0x80, 0x88, 0x70 },

/*
	   *
	   *
	****
   *   *
   *   *
   *   *
	****
*/
	{0x00, 0x08, 0x08, 0x78, 0x88, 0x88, 0x88, 0x78 },

/*
		
	   
	*** 
   *   *
   *****
   *   
	****
*/
	{0x00, 0x00, 0x00, 0x70, 0x88, 0xF8, 0x80, 0x78 },

/*
	  **
	 *  
	*** 
	 * 
	 *  
	 *  
	 *
*/
	{0x00, 0x18, 0x20, 0x70, 0x20, 0x20, 0x20, 0x20 },

/*
	   
		
	****
   *   *
	****
	   *
   ****
*/
	{0x00, 0x00, 0x00, 0x78, 0x88, 0x78, 0x08, 0xF0 },

/*
   *	
   *	
   * ** 
   **  *
   *   *
   *   *
   *   *
*/
	{0x00, 0x80, 0x80, 0xB0, 0xC8, 0x88, 0x88, 0x88 },

/*
	 *
	  
	 * 
	 * 
	 * 
	 * 
	 * 
*/
	{0x00, 0x20, 0x00, 0x20, 0x20, 0x20, 0x20, 0x20 },

/*
	  *

	  *
	  *
	  *
	* *
	 *
*/
	{0x00, 0x10, 0x00, 0x10, 0x10, 0x10, 0x50, 0x20 },

/*
	*
	*
	*  *
	* *
	**
	* *
	*  *
*/
	{0x00, 0x40, 0x40, 0x48, 0x50, 0x60, 0x50, 0x48 },

/*
	 *
	 *
	 * 
	 * 
	 * 
	 * 
	 * 
*/
	{0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20 },

/*


	* *
   * * *
   * * *
   *   *
   *   *
*/
	{0x00, 0x00, 0x00, 0x50, 0xA8, 0xA8, 0x88, 0x88 },

/*


   * **
   **  *
   *   *
   *   *
   *   *
*/
	{0x00, 0x00, 0x00, 0xB0, 0xC8, 0x88, 0x88, 0x88 },

/*


	***
   *   *
   *   *
   *   *
	***
*/
	{0x00, 0x00, 0x00, 0x70, 0x88, 0x88, 0x88, 0x70 },

/*


   ****
   *   *
   ****
   *
   *
*/
	{0x00, 0x00, 0x00, 0xF0, 0x88, 0xF0, 0x80, 0x80 },

/*

   
	****
   *   *
	****
	   *
	   *
*/
	{0x00, 0x00, 0x00, 0x78, 0x88, 0x78, 0x08, 0x08 },

/*


   * ***
   **  
   *  
   *   
   *	
*/
	{0x00, 0x00, 0x00, 0xB8, 0xC0, 0x80, 0x80, 0x80 },

/*


	****
   *   
	***
	   *
   ****
*/
	{0x00, 0x00, 0x00, 0x78, 0x80, 0x70, 0x08, 0xF0 },

/*
	 *
	 *
	***
	 * 
	 * 
	 * 
	 **
*/
	{0x00, 0x20, 0x20, 0x70, 0x20, 0x20, 0x20, 0x30 },

/*


   *   *
   *   *
   *   *
   *   *
	***
*/
	{0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x88, 0x70 },

/*


   *   *
   *   *
   *   *
	* *
	 *
*/
	{0x00, 0x00, 0x00, 0x88, 0x88, 0x88, 0x50, 0x20},

/*


   *   *
   *   *
   * * *
   * * *
	* *
*/
	{0x00, 0x00, 0x00, 0x88, 0x88, 0xA8, 0xA8, 0x50 },

/*


   *   *
	* *
	 *
	* *
   *   *
*/
	{0x00, 0x00, 0x00, 0x88, 0x50, 0x20, 0x50, 0x88 },

/*


   *   *
   *   *
	****
	   *
   ****
*/
	{0x00, 0x00, 0x00, 0x88, 0x88, 0x78, 0x08, 0xF0 },

/*


   *****
	  * 
	 * 
	* 
   *****
*/
	{0x00, 0x00, 0x00, 0xF8, 0x10, 0x20, 0x40, 0xF8 }

};

unsigned char numeric_font[10][8] = {

/*
	***
   *   *
   *  **
   * * *
   **  *
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x98, 0xA8, 0xC8, 0x88, 0x70 },
	
/*
	 *
	**
	 * 
	 * 
	 * 
	 * 
	***
*/
	{0x00, 0x20, 0x60, 0x20, 0x20, 0x20, 0x20, 0x70 },

/*
	***
   *   *
	   *
	  *
	 *
	*   
   *****
*/
	{0x00, 0x70, 0x88, 0x08, 0x10, 0x20, 0x40, 0xF8 },

/*
	***
   *   *
	   *
	 **
	   * 
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x08, 0x30, 0x08, 0x88, 0x70 },

/*
	  *
	 **
	* *
   *  *
   ***** 
	  *
	  *
*/
	{0x00, 0x10, 0x30, 0x50, 0x90, 0xF8, 0x10, 0x10 },

/*
   *****
   *
   ****
	   *
	   * 
   *   *
	***
*/
	{0x00, 0xF8, 0x80, 0xF0, 0x08, 0x08, 0x88, 0x70 },

/*
	 **
	*
   *
   ****
   *   * 
   *   *
	***
*/
	{0x00, 0x30, 0x40, 0x80, 0xF0, 0x88, 0x88, 0x70 },

/*
   *****
	   *
	  *
	 *
	 * 
	 *
	 *
*/
	{0x00, 0xF8, 0x08, 0x10, 0x20, 0x20, 0x20, 0x20 },

/*
	***
   *   *
   *   *
	***
   *   *
   *   *
	***
*/
	{0x00, 0x70, 0x88, 0x88, 0x70, 0x88, 0x88, 0x70 },


/*
	***
   *   *
   *   *
	****
	   *
	  *
	**
*/
	{0x00, 0x70, 0x88, 0x88, 0x78, 0x08, 0x10, 0x60 }

};

// (note that "~" isn't really a tilde, but rather it is
// a "long" dash that will allow for a solid line)
char other_font_index[22] = { " \":._-*~/,()@&+?<>=|[]" };

unsigned char other_font[22][8] = {

/*







*/
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },

/*
	* *
	* *





*/
	{0x00, 0x50, 0x50, 0x00, 0x00, 0x00, 0x00, 0x00 },

/*

	**
	**

	**
	**

*/
	{0x00, 0x00, 0x60, 0x60, 0x00, 0x60, 0x60, 0x00 },

/*





	**
	**
*/
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x60 },

/*






   *****
*/
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8 },

/*



   *****



*/
	{0x00, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00 },

/*
	 * 
   * * *
	***
   *****
	***
   * * *
	 *
*/
	{0x00, 0x20, 0xA8, 0x70, 0xF8, 0x70, 0xA8, 0x20 },

/*



   ******



*/
	{0x00, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00 },

/*
	   *
	   *
	  *
	 *
	*
   *
   *
*/
	{0x00, 0x08, 0x08, 0x10, 0x20, 0x40, 0x80, 0x80 },

/*




	**
	 *
	*
*/
	{0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x20, 0x40 },

/*
	  *
	 *
	*
	*
	*
	 *
	  *
*/
	{0x00, 0x10, 0x20, 0x40, 0x40, 0x40, 0x20, 0x10 },

/*
	*
	 *
	  *
	  *
	  *
	 *
	*
*/
	{0x00, 0x40, 0x20, 0x10, 0x10, 0x10, 0x20, 0x40 },

/*
	***
   *   *
	   *
	** *
   * * *
   * * *
	***
*/
	{0x00, 0x70, 0x88, 0x08, 0x68, 0xA8, 0xA8, 0x70 },

/*
	 **
	*  *
	* *
	 *
   * * *
	*  *
	** *
*/
	{0x00, 0x60, 0x90, 0xA0, 0x40, 0xA8, 0x90, 0x68 },

/*

	 *
	 *
   *****
	 *
	 *

*/
	{0x00, 0x00, 0x20, 0x20, 0xF8, 0x20, 0x20, 0x00 },

/*
	***
   *   *
	   *
	 * 
	 *
	 
	 *
*/
	{0x00, 0x70, 0x88, 0x08, 0x20, 0x20, 0x00, 0x20 },

/*
	   *
	  *
	 *
	*
	 *
	  *
	   *
*/

	{0x00, 0x08, 0x10, 0x20, 0x40, 0x20, 0x10, 0x08 },
	
/*
	*
	 *
	  *
	   *
	  *
	 *
	*
*/

	{0x00, 0x40, 0x20, 0x10, 0x08, 0x10, 0x20, 0x40 },
	
/*


   *****

   *****


*/

	{0x00, 0x00, 0x00, 0xF8, 0x00, 0xF8, 0x00, 0x00 },
	
/*
   *
   *
   *
   *
   *
   *
   *
*/

	{0x00, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20, 0x20 },
	

/*
	***
	*
	*
	*
	*
	*
	***	 
*/
	
	{0x00, 0x70, 0x40, 0x40, 0x40, 0x40, 0x40, 0x70 },
	
/*
	***
	  *
	  *
	  *
	  *
	  *
	***
*/
	
	{0x00, 0x70, 0x10, 0x10, 0x10, 0x10, 0x10, 0x70 }
	
};

#define BITMAP_XRES			 8
#define BITMAP_YRES			 7

int paint_char(
	int xpos,
	int ypos,
	char ch,
	int highlight,
	char *dst_out,
	int k,
	int len_left)
{
	char *bit_map = NULL;
	
	printf("<TEXT> paint_string ch:%c, k %d\n", ch, k);
	int i, j;

	// Get the character bit map.
	//
	if (ch >= 'A' && ch <= 'Z') {
		bit_map = alpha_font_upper[ch - 'A'];

	} else if (ch >= 'a' && ch <= 'z') {
		bit_map = alpha_font_lower[ch - 'a'];

	} else if (ch >= '0' && ch <= '9') {
		bit_map = numeric_font[ch - '0'];

	} else {
		char c = ch;
		if (isspace((int)c)) {
			c = ' ';
		}

		for (i = 0; i < (int)sizeof(other_font_index); ++i) {
			if (c == other_font_index[i]) {
				bit_map = other_font[i];
				break;
			}
		}
	}
	// If the character bit map exists, convert it into an image.
	//
	if (bit_map)
	{
		//transfer to Y8, 1->0x00, 0 -> 0xFF
	 	for (i = 0; i < BITMAP_XRES; i++)
	 	{
			printf("bit_map[%d] = %x len_left %d, k %d\n", i, bit_map[i], len_left, k);
			for (j = 0; j < 8; j++)
			{
			   if (bit_map[i] & (0x80 >> j))
			   {
				   dst_out[k] = 0x00;
				   //printf("1 dst_out[%d] = %x\n", k, dst_out[k]);
			   }
			   else
			   {
				   dst_out[k] = 0xFF;
				   //printf("0 dst_out[%d] = %x\n", k, dst_out[k]);
			   }
			   k++;
			}
			k = k + len_left * 8; //need jump to next all char
		}
	}
	else {
		printf("character \"%c\" not available\n", ch);
		return 1;
	}

	return 0;
}

int paint_string(
	int xpos,
	int ypos,
	const char *s,
	char * dst_out, 
	int highlight)
{
	int i, len = strlen(s);
	int k = 0;
	int len_left = len - 1;
	printf("<TEXT> paint_string s:%s\n", s);

	for (i = 0; i < len; ++i) {
		if (paint_char(xpos + i, ypos, s[i], highlight, dst_out, k, len_left)) {
		return 1;
	   }
	   k = k + 8; //next char need remove after 8
	}
	
	return 0;
}

int draw_text(Pattern_parm *ptPatternParm)
{
	printf("<TEXT> input_buf:%s\n", ptPatternParm->input_buf);
#if 0
	fdes = fopen("text1.bin", "w");
	if(!fdes)
	{
	 printf("<GRAPHIC>open file error!\n");
	 return 0;
	}
	int len = strlen(rPatternParm.input_buf);
	char * dst_out = malloc(len * BITMAP_XRES * BITMAP_XRES);
	memset(dst_out, 0, len * BITMAP_XRES * BITMAP_XRES);
	paint_string(rPatternParm.rDisplayRegion.x_point, rPatternParm.rDisplayRegion.y_point, rPatternParm.input_buf, dst_out, 0);
	fwrite(dst_out, sizeof(int), len * BITMAP_XRES * BITMAP_XRES, fdes);
	if (dst_out)
	{
	 free(dst_out);
	 dst_out = NULL;
	}
	#endif
	
	int len = strlen(ptPatternParm->input_buf);
	//unsigned char * dst_out[3] = {NULL, NULL, NULL};
	//dst_out[0] = malloc(len * BITMAP_XRES * BITMAP_XRES);
	//memset(dst_out[0], 0, len * BITMAP_XRES * BITMAP_XRES);
	paint_string(ptPatternParm->rDisplayRegion.x_point, 
				 ptPatternParm->rDisplayRegion.y_point, 
				 ptPatternParm->input_buf, 
				 ptPatternParm->src_addr[0], 
				 0);
	ptPatternParm->pixelSize = len * BITMAP_XRES * BITMAP_XRES;
	ptPatternParm->src_width = len * BITMAP_XRES;
	ptPatternParm->src_height = BITMAP_XRES;
	if (0 == ptPatternParm->iCropType)
	{
		ptPatternParm->rCropRegion.width = ptPatternParm->src_width;
		ptPatternParm->rCropRegion.height = ptPatternParm->src_height;
	}

	#if 0
	fwrite(ptPatternParm->src_addr[0], sizeof(int), len * BITMAP_XRES * BITMAP_XRES, fdes);
	
	fclose(fdes);
	#endif
	return 0;
}

